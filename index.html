<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ito</title>
<style>
  body {
    font-family: sans-serif;
    height:85vh;
    width:100%;
    margin:0;
    padding:0;
    display:flex;
    justify-content:center;
    align-items:center;
    background:#f0f0f0;
    text-align:center;
  }

  button {
    border:none;
    background:#4CAF50;
    color:white;
    cursor:pointer;
    transition: background 0.2s;
  }

  button:hover { background:#45a049; }

  .card {
    background:white;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    opacity:0;
    animation: fadeIn 0.5s forwards;
    position:relative;
    z-index:1; /* 後から出すカードを上に */
  }

  .card:first-child {
    margin-left:0; /* 最初のカードは左端から */
  }

  .card .playerLabel {
    position:absolute;
    left:0;
    right:0;
    text-align:center;
    color:#555;
  }

  #revealedLog, #revealedLog2 {
    display:flex;
    justify-content:center;
    position:relative;
  }

  .hidden { display:none; }
  
  .card.wrong {
    border: 0.5vw solid red; /* 太枠赤 */
    color: red;              /* 数字文字色も赤 */
  }

  @keyframes fadeIn {
    to { opacity:1; transform:translateY(0); }
  }

  /* 縦長（portrait） */
  @media screen and (orientation: portrait) {
    h1 { font-size:20vh; margin:0 0 20px 0; }
    h2 { font-size:7vw; }
    h3 { font-size:5vw; }
    p { font-size:4vw; }
    #topic, #resultMessage { font-size:4vw; }
    #confirmToggle { 
      width:3vw;
      height:3vw;
    }
    .number_box { font-size:5vw; }
    button {
      padding:1vh 2vh;
      margin:1vh;
      font-size:2.5vh;
      border-radius:1vh;
    }
    .card {
      width:16vw;
      height:24vw;
      margin-left:-2vw;
      border-radius:2vw;
      box-shadow:0 0.8vw 1.6vw rgba(0,0,0,0.2);
      font-size:9.5vw;
      transform:translateY(-4vw);
    }
    .card .playerLabel {
      font-size:3vw;
      top:1vw;
    }
    #revealedLog { margin-top:4vw; }
    #revealedLog2 { margin-top:4vw; }
  }

  /* 横長（landscape） */
  @media screen and (orientation: landscape) {
    h1 { font-size:20vw; margin:0 0 20px 0; }
    h2 { font-size:3vw; }
    h3 { font-size:2vw; }
    p { font-size:1.5vw; }
    #topic, #resultMessage { font-size:1.5vw; }
    #confirmToggle { 
      width:1.5vw;
      height:1.5vw;
    }
    .number_box { font-size:3vw; }
    button {
      padding:1vw 2vw;
      margin:1vh;
      font-size:2.5vw;
      border-radius:1vw;
    }
    .card {
      width:16vh;
      height:24vh;
      margin-left:-2vh;
      border-radius:2vh;
      box-shadow:0 0.8vh 1.6vh rgba(0,0,0,0.2);
      font-size:9.5vh;
      transform:translateY(-4vw);
    }
    .card .playerLabel {
      font-size:3vh;
      top:1vh;
    }
    #revealedLog { margin-top:4vh; }
    #revealedLog2 { margin-top:4vh; }
  }
</style>

</head>
<body>

<div id="setup">
  <h1>ito</h1>
  <h2>人数を選んでください</h2>
  <input type="number" class="number_box" id="playerCount" min="2" max="10" value="4">
  <br>
  <label>
    <p>
    <input type="checkbox" id="confirmToggle" checked>
    ダイアログを表示</p>
  </label>
  <br>
  <button onclick="startGame()">開始</button>
</div>

<div id="assign" class="hidden">
  <h2 id="assignTitle"></h2>
  <button id="assignOkBtn" onclick="showNumber()">OK</button>
</div>

<div id="showNumber" class="hidden">
  <h2 id="numberMessage"></h2>
  <button onclick="nextPlayer()">次へ</button>
</div>

<div id="game" class="hidden">
  <h2>お題</h2>
  <div id="topic"></div>
  <button onclick="recheckNumber()">自分の数字を確認</button>
  <h3>数字を公開</h3>
  <div id="revealArea"></div>
  <div id="revealedLog"></div>
</div>

<div id="result" class="hidden">
  <h2>ゲーム結果</h2>
  <div id="resultMessage"></div>
  <div id="revealedLog2"></div> <!-- 結果画面でも同じカードを表示 -->
  <br>
  <button onclick="restartGame()">もう一度遊ぶ</button>
  <button onclick="backToStart()">最初に戻る</button>
</div>

<script>
let players = [];
let currentPlayerIndex = 0;
let revealed = [];
let confirmOnReveal = true; // 公開時にダイアログを出すかどうか
let topics = [
"旅先ですることの人気（1:人気ない-100:人気ある）",
"白米に合いそうなもの（1:合わない-100:合う）",
"中学生になって考えよう カッコいいもの・こと（1:カッコわるい-100:カッコいい）",
"鳥肌が立つこと（1:少し立つ-100:超立つ）",
"1000円くらいまででできる楽しいこと（1:そこそこ-100:楽しい）",
"桃太郎になって考えよう 頼りになる家来（1:頼りにならない-100:頼りになる）",
"動物園にいる動物の人気（1:人気ない-100:人気ある）",
"男女がそれぞれ好きそうなもの（1:男が好きなもの-100:女が好きなもの）",
"祖父母になって考えよう 孫に言われたら嬉しい言葉（1:嬉しくない-100:嬉しい）",
"ふだん聞く言葉の頻度（1:あまり聞かない-100:よく聞く）",
"破壊力のある言葉（パワーワード）（1:破壊力ない-100:破壊力ある）",
"冷蔵庫になって考えよう 入れてほしいもの（1:入れてほしくない-100:入れてほしい）",
"行事の人気（1:人気ない-100:人気ある）",
"乗り物の人気（1:人気ない-100:人気ある）",
"食べ物の人気（1:人気ない-100:人気ある）",
"なりたい有名人（1:なりたくない-100:なりたい）",
"都市の人気（1:人気ない-100:人気ある）",
"世界の料理の人気（1:人気ない-100:人気ある）",
"テレビ番組の人気（1:人気ない-100:人気ある）",
"アニメ・漫画の人気（1:人気ない-100:人気ある）",
"映画の人気（1:人気ない-100:人気ある）",
"ゲームの人気（1:人気ない-100:人気ある）",
"歌手の人気（1:人気ない-100:人気ある）",
"動物の人気（1:人気ない-100:人気ある）",
"色の人気（1:人気ない-100:人気ある）",
"花の人気（1:人気ない-100:人気ある）",
"国の人気（1:人気ない-100:人気ある）",
"職業の人気（1:人気ない-100:人気ある）",
"スポーツの人気（1:人気ない-100:人気ある）",
"楽器の人気（1:人気ない-100:人気ある）",
"観光地の人気（1:人気ない-100:人気ある）",
"都道府県の人気（1:人気ない-100:人気ある）",
"野菜の人気（1:人気ない-100:人気ある）",
"果物の人気（1:人気ない-100:人気ある）",
"魚介類の人気（1:人気ない-100:人気ある）",
"飲み物の人気（1:人気ない-100:人気ある）",
"お菓子の人気（1:人気ない-100:人気ある）",
"調味料の人気（1:人気ない-100:人気ある）",
"冷蔵庫の中にあったらテンションが上がるもの（1:上がらない-100:上がる）",
"高校生になって考えよう 授業中、起きたら大変なこと（1:大変じゃない-100:大変）",
"写真を撮りたくなるもの（1:そうでもない-100:撮りたくなる）",
"どうしてもこれだけは許せないということ（1:許せなくはない-100:許せない）",
"幸せを感じること（1:感じない-100:感じる）",
"新婚旅行先の人気（1:行きたくない-100:行きたい）",
"学校の先生に怒られそうなこと（1:怒られない-100:怒られる）",
"犬になって考えよう 嬉しいこと（1:嬉しくない-100:嬉しい）",
"よく行く場所（1:あまり行かない-100:よく行く）",
"思わず見てしまうメールのタイトル（1:見ない-100:見てしまう）",
"ボディビルダーになって考えよう 言われたいかけ声（1:言われたくない-100:言われたい）",
"生まれ変わったらなりたい動物（1:なりたくない-100:なりたい）",
"大人っぽい言動（1:子供っぽい-100:大人っぽい）",
"動画配信者にとって必要な能力・資質（1:あっちゃダメ-100:必要）",
"家族にしてもらったら嬉しいこと（1:嬉しくない-100:嬉しい）",
"ショックを受けた好きな人のクセ（1:少しショック-100:超ショック）",
"侍になって考えよう 尽くしたいタイプの人（1:尽くしたくない-100:尽くしたい）",
"食べ物のやわらかさ（1:かたい-100:やわらかい）",
"突然の一日オフ。最高の過ごし方は？（1:最悪-100:最高）",
"先生になって考えよう 卒業式に言われて嬉しい言葉（1:嬉しくない-100:嬉しい）",
"幼いころにほしかったもの（1:そうでもない-100:ほしかった）",
"宇宙にいるときにやってみたい行動（1:やりたくない-100:やってみたい）",
"お笑い芸人にとって必要な能力・資質（1:あっちゃダメ-100:必要）",
"寝起きにしたいこと（1:したくない-100:したい）",
"変顔の度合い（実際にやる）（1:ふつう顔-100:変顔）",
"修学旅行生になって考えよう 行きたい旅行先（1:行きたくない-100:行きたい）",
"部屋の中にある大切なもの（1:大切ではない-100:大切）",
"痛い思い出（物理・精神どちらでも）（1:痛くない-100:痛い）",
"生きる上で大切なもの・こと（1:むしろダメ-100:大切）",
"食べ物の辛さ（1:辛くない-100:辛い）",
"カッコいいと思うエピソード（1:カッコわるい-100:カッコいい）",
"就活中の大学生になって考えよう 働きたい職場（1:働きたくない-100:働きたい）",
"聞こえてきたら嬉しい音（1:嬉しくない-100:嬉しい）",
"厳しく無口な父に言われたら嬉しい言葉（1:嬉しくない-100:嬉しい）",
"アイドル業にとって必要な能力・資質（1:あっちゃダメ-100:必要）",
"黒いもの（1:黒くない-100:黒い）",
"卒業式で流したら感動する音楽や効果音（1:ぶち壊し-100:感動する）",
"魔法使いになって考えよう 使ってみたい魔法（1:使いたくない-100:使ってみたい）",
"日常に起こるいいこと（1:よくない-100:いい）",
"片思い中の好きな人に言われたら嬉しい言葉（1:嬉しくない-100:嬉しい）",
"仕事をする上で必要な能力・資質（1:あっちゃダメ-100:必要）",
"眠くなるもの（1:目が覚める-100:眠くなる）",
"見た目が子供に戻ったならしたいこと（1:したくない-100:したい）",
"馬主になって考えよう 速そうな馬の名前（1:速くなさそう-100:速そう）",
"投げたいもの（1:投げたくない-100:投げたい）",
"勇気ある行動（1:勇気ない-100:勇気ある）",
"芸能事務所の社長になって考えよう 所属芸能人が起こしたら大変な事件（1:大変じゃない-100:大変）",
"包まれたいもの（1:包まれたくない-100:包まれたい）",
"砂漠で遭難したときにほしいもの（1:いらない-100:ほしい）",
"超能力になって考えよう 友人の脳内を読んだらショックだった考え（1:少しショック-100:超ショック）",
"ずっと見ていられるもの（1:見ていられない-100:見ていられる）",
"死ぬまでにしたいこと（1:しなくてもいい-100:したい）",
"ヒーローになって演じよう カッコいいポーズ（実際にやる）（1:カッコわるい-100:カッコいい）",
"なつかしさを感じるもの・こと（1:感じない-100:感じる）",
"テストでその点を取ったときの反応（1:1点-100:100点）",
"母になって考えよう 子供が寝言で言っていたら嬉しいこと（1:嬉しくない-100:嬉しい）",
"SNSでめちゃくちゃいいねされそうな投稿（1:いいねされなさそう-100:いいねされそう）",
"人物やキャラクターのイメージ（1:クール-100:パッション）",
"疲れたときにしたいこと（1:したくない-100:したい）",
"あったらおいしそうなアイスクリームの味（1:おいしくなさそう-100:おいしそう）",
"赤ちゃんになって考えよう 最高の瞬間（1:最悪-100:最高）",
"家にある便利なもの（1:便利じゃない-100:便利）",
"5歳児が言ったらビックリする言葉（1:少しビックリ-100:超ビックリ）",
"魔王になって考えよう こんな勇者はイヤだ（1:余裕-100:イヤだ）",
"大学生が反応する言葉（1:反応しない-100:反応する）",
"機嫌がいいときにしそうな行動（1:しなさそう-100:しそう）",
"リーダーにとって必要な能力・資質（1:あっちゃダメ-100:必要）",
"友達になりたい人の特徴（1:なりたくない-100:なりたい）",
"人生の中で、やる回数が多いこと（1:少ない-100:多い）",
"愛されていると思うこと（1:愛されていない-100:愛されている）",
"おばあちゃんになって考えよう 孫にされて嬉しいこと（1:嬉しくない-100:嬉しい）",
"初デートで言われたら嬉しい言葉（1:嬉しくない-100:嬉しい）",
"好きな人からのLINEで嬉しいスタンプ（1:嬉しくない-100:嬉しい）",
"引越し先の条件（1:どうでもいい-100:重要）",
"絶対にやりたくないアルバイト（1:やってもいい-100:絶対イヤ）",
"無人島に持っていくなら？（1:いらない-100:必要）",
"縁日の屋台の人気（1:人気ない-100:人気ある）",
"心が折れそうになる瞬間（1:折れない-100:折れる）",
"手品でやってみたいネタ（1:やりたくない-100:やりたい）",
"部屋にあったら嫌なもの（1:あってもいい-100:嫌だ）",
"新社会人になって考えよう 仕事で大事なこと（1:大事じゃない-100:大事）",
"宝くじが当たったら買いたいもの（1:買わない-100:買いたい）",
"涙が出そうになる瞬間（1:出ない-100:出る）",
"映画館で隣にいたら嫌な人の行動（1:気にならない-100:嫌だ）",
"ひとり暮らしに必須なもの（1:不要-100:必須）",
"人生で恥ずかしかった瞬間（1:恥ずかしくない-100:恥ずかしい）",
"恋人にされて嬉しいこと（1:嬉しくない-100:嬉しい）",
"夜中に突然食べたくなるもの（1:食べたくない-100:食べたい）",
"疲れが吹き飛ぶ瞬間（1:吹き飛ばない-100:吹き飛ぶ）",
"もし透明人間になったらやってみたいこと（1:したくない-100:したい）",
"人生で一度は挑戦したいこと（1:挑戦したくない-100:挑戦したい）",
"テンションが下がる天気（1:下がらない-100:下がる）",
"将来住みたい場所（1:住みたくない-100:住みたい）",
"空から降ってきてほしいもの（1:降ってきても微妙-100:降ってきてほしい）",
"恋人に言われたら冷める一言（1:冷めない-100:冷める）",
"テンションが爆上がりする音楽（1:上がらない-100:上がる）",
"タイムマシンで行きたい時代（1:行きたくない-100:行きたい）",
"宇宙人に会ったら言いたいこと（1:言わなくていい-100:言いたい）",
"絶対に手放せないもの（1:手放せる-100:手放せない）",
"料理をするときに必要なもの（1:不要-100:必要）",
"旅行先で絶対にしたいこと（1:したくない-100:したい）",
"卒業旅行で行きたい場所（1:行きたくない-100:行きたい）",
"10年後の自分に伝えたいこと（1:伝えなくていい-100:伝えたい）",
"どうしてもやめられないこと（1:やめられる-100:やめられない）",
"夜眠れないときにすること（1:しない-100:する）",
"思わず叫んでしまう瞬間（1:叫ばない-100:叫ぶ）",
"お祭りで一番楽しみなこと（1:楽しみじゃない-100:楽しみ）",
"学校に持って行きたいもの（1:不要-100:必要）",
"もし1日だけ入れ替われるなら誰と？（1:入れ替わりたくない-100:入れ替わりたい）",
"夢の中でしてみたいこと（1:したくない-100:したい）",
"この上なく幸せを感じる瞬間（1:感じない-100:感じる）",
"今すぐに食べたいもの（1:食べたくない-100:食べたい）",
"お金がいくらあっても買えないもの（1:別に欲しくない-100:欲しい）",
"告白されたいシチュエーション（1:嬉しくない-100:嬉しい）",
"運動会で盛り上がる競技（1:盛り上がらない-100:盛り上がる）",
"人生でやり直したい瞬間（1:やり直さなくていい-100:やり直したい）",
"逆に二度とやりたくないこと（1:別にいい-100:絶対イヤ）",
"もし魔法が一つだけ使えたら？（1:使いたくない-100:使いたい）",
"家族旅行で行きたい場所（1:行きたくない-100:行きたい）",
"眠気が一瞬で覚める瞬間（1:覚めない-100:覚める）",
"泣きたいときにすること（1:しない-100:する）",
"気まずい沈黙を破る言葉（1:破れない-100:破れる）",
"最高のご褒美（1:微妙-100:最高）",
"もし空を飛べたらやってみたいこと（1:したくない-100:したい）",
"友達にされたら怒ること（1:怒らない-100:怒る）",
"死ぬほど笑った瞬間（1:笑わない-100:笑う）",
"家族に言われて嬉しい一言（1:嬉しくない-100:嬉しい）",
"旅館にあったら嬉しいサービス（1:嬉しくない-100:嬉しい）",
"もし超能力をひとつだけ持てるなら？（1:欲しくない-100:欲しい）",
"毎日食べても飽きないもの（1:飽きる-100:飽きない）",
"将来の夢（1:叶わなくていい-100:叶えたい）",
"やってみたいスポーツ（1:やりたくない-100:やりたい）",
"心から感謝していること（1:感謝してない-100:感謝してる）",
"テンションが上がる匂い（1:上がらない-100:上がる）",
"大切な人に伝えたい一言（1:言わなくていい-100:伝えたい）",
"一生に一度は見たい景色（1:見なくてもいい-100:見たい）",
"家に帰って最初にすること（1:しない-100:する）",
"人生で忘れられない瞬間（1:忘れる-100:忘れない）",
"眠れない夜に考えること（1:考えない-100:考える）",
"世界一幸せを感じるとき（1:感じない-100:感じる）",
"お金では買えない幸せ（1:感じない-100:感じる）",
"恋人にプレゼントしたいもの（1:あげない-100:あげたい）",
"クリスマスに欲しいもの（1:いらない-100:欲しい）",
"新年の抱負（1:別にいい-100:大事）",
"夏祭りで一番楽しみなこと（1:楽しみじゃない-100:楽しみ）",
"バレンタインでもらったら嬉しいもの（1:嬉しくない-100:嬉しい）",
"もし世界一周できるなら行きたい場所（1:行きたくない-100:行きたい）",
"絶対に負けたくないこと（1:負けてもいい-100:負けたくない）",
"誕生日にしてほしいこと（1:どうでもいい-100:してほしい）",
"親友になんでもない日に言われて嬉しいこと（1:嬉しくない-100:嬉しい）",
"もし一日だけ動物になれるなら何をしたい？（1:したくない-100:したい）",
"人生で一番驚いた瞬間（1:驚かない-100:驚く）",
"大切にしている習慣（1:大切じゃない-100:大切）",
"もし世界が終わるなら最後にしたいこと（1:したくない-100:したい）",
"勇気を出してよかった瞬間（1:よくなかった-100:よかった）",
"結婚式でしてほしい演出（1:いらない-100:欲しい）",
"生まれ変わったらなりたいもの（1:なりたくない-100:なりたい）",
"人生で一番幸せだった瞬間（1:幸せじゃない-100:幸せ）",
"二度と聞きたくない言葉（1:聞いてもいい-100:聞きたくない）",
"未来の自分に感謝していること（1:感謝してない-100:感謝してる）",
"テンションが爆上がりする瞬間（1:上がらない-100:上がる）",
"恋人としたいデート（1:したくない-100:したい）",
"思わず涙が出る映画やドラマ（1:泣かない-100:泣く）",
"絶対に忘れたくないこと（1:忘れる-100:忘れない）",
"家族に感謝していること（1:感謝してない-100:感謝してる）",
"人生でやってみたい冒険（1:やらなくていい-100:やりたい）",
"愛を感じる瞬間（1:感じない-100:感じる）",
"二度と経験したくないこと（1:経験してもいい-100:経験したくない）",
"人生の宝物（1:どうでもいい-100:宝物）",
"最高の一日（1:最悪-100:最高）",
"絶対に笑ってしまうこと（1:笑わない-100:笑う）",
"将来叶えたい夢（1:叶えなくていい-100:叶えたい）",
"心に残る名言（1:残らない-100:残る）",
"子供の頃に好きだった遊び（1:好きじゃない-100:好き）",
"家族で行きたい場所（1:行きたくない-100:行きたい）",
"大切な人としたいこと（1:したくない-100:したい）",
"一生の思い出にしたいこと（1:したくない-100:したい）",
"人生で一番大事にしていること（1:大事じゃない-100:大事）",
"絶対に許せないこと（1:許せる-100:許せない）",
"友達としたい冒険（1:したくない-100:したい）",
"将来やってみたい仕事（1:やりたくない-100:やりたい）",
"恋人と見たい景色（1:見なくてもいい-100:見たい）",
"幸せを感じる瞬間（1:感じない-100:感じる）",
"眠る前に考えること（1:考えない-100:考える）",
"人生で一番楽しかった瞬間（1:楽しくない-100:楽しい）",
"絶対にやりたくないこと（1:やってもいい-100:やりたくない）",
"子供の頃になりたかった職業（1:なりたくない-100:なりたい）",
"人生で一番緊張した瞬間（1:緊張しない-100:緊張する）",
"もし100万円もらったら買いたいもの（1:買わない-100:買いたい）",
"テンションが上がる言葉（1:上がらない-100:上がる）",
"人生で後悔していること（1:後悔してない-100:後悔してる）",
"将来住みたい家（1:住みたくない-100:住みたい）",
"心が温まる瞬間（1:温まらない-100:温まる）",
"絶対に挑戦したいこと（1:したくない-100:したい）",
"人生で一番感動した瞬間（1:感動しない-100:感動する）",
"大切な人に言われて嬉しかった言葉（1:嬉しくない-100:嬉しい）",
"旅先で食べたいもの（1:食べたくない-100:食べたい）",
"心から笑った瞬間（1:笑わない-100:笑う）",
"人生で一番怖かった瞬間（1:怖くない-100:怖い）",
"もし一日だけ好きなことができるなら？（1:しない-100:する）",
"人生で一番嬉しかった瞬間（1:嬉しくない-100:嬉しい）",
"二度と行きたくない場所（1:行ってもいい-100:行きたくない）",
"友達に感謝していること（1:感謝してない-100:感謝してる）",
"朝起きて最初にしたいこと（1:したくない-100:したい）",
"人生で一番心に残ったゲームの瞬間（1:残らない-100:残る）",
"AIに任せたいこと（1:任せたくない-100:任せたい）",
"もし一週間だけ超人になれたらしたいこと（1:したくない-100:したい）",
"未来の子供に伝えたいこと（1:伝えなくてもいい-100:伝えたい）",
"宇宙旅行で持っていきたいもの（1:不要-100:必要）",
"いま食べたいもの（1:食べたくない-100:食べたい）",
"夜中に目が覚めたときにやりたいこと（1:やりたくない-100:やりたい）",
"お風呂で歌いたい曲（1:歌いたくない-100:歌いたい）",
"子どもに人気のキャラクター（1:人気ない-100:人気ある）",
"人類が発明したすごいもの（1:すごくない-100:すごい）",
"家に置きたいインテリア（1:置きたくない-100:置きたい）",
"親友になりたい人物（1:なりたくない-100:なりたい）",
"もし魔法が使えたらやりたいこと（1:やりたくない-100:やりたい）",
"一度は見てみたい景色（1:見なくてもいい-100:見たい）",
"疲れた日に食べたいもの（1:食べたくない-100:食べたい）",
];

function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

function startGame() {
  const n = parseInt(document.getElementById("playerCount").value, 10);
  confirmOnReveal = document.getElementById("confirmToggle").checked; // ←チェック状態を保存
  let numbers = shuffle(Array.from({length:100}, (_,i)=>i+1));
  players = [];
  revealed = [];
  document.getElementById("revealedLog").innerHTML = ""; // 前回のカードを消す
  for (let i=0; i<n; i++) {
    players.push({id: i+1, num: numbers[i], revealed: false});
  }
  currentPlayerIndex = 0;
  document.getElementById("setup").classList.add("hidden");
  document.getElementById("assign").classList.remove("hidden");
  document.getElementById("assignTitle").textContent = players[0].id + "Pの人だけ見てください";

  let topic = topics[Math.floor(Math.random()*topics.length)];
  document.getElementById("topic").textContent = topic;
}

function showNumber() {
  const p = players[currentPlayerIndex];
  document.getElementById("assign").classList.add("hidden");
  document.getElementById("showNumber").classList.remove("hidden");
  document.getElementById("numberMessage").textContent = 
    "あなたは " + p.num + " です";
}

function nextPlayer() {
  currentPlayerIndex++;
  if (currentPlayerIndex < players.length) {
    document.getElementById("showNumber").classList.add("hidden");
    document.getElementById("assign").classList.remove("hidden");
    document.getElementById("assignTitle").textContent = 
      players[currentPlayerIndex].id + "Pの人だけ見てください";
  } else {
    document.getElementById("showNumber").classList.add("hidden");
    document.getElementById("game").classList.remove("hidden");
    renderRevealButtons();
  }
}

function recheckNumber() {
  const pid = prompt("確認したいプレイヤー番号を入力してください (例: 1)");
  if (!pid) return;
  const p = players.find(x => x.id == pid);
  if (p) {
    alert(pid + "Pの数字は " + p.num + " です");
  } else {
    alert("該当プレイヤーがいません");
  }
}

function renderRevealButtons() {
  const area = document.getElementById("revealArea");
  area.innerHTML = "";
  players.forEach(p=>{
    if (!p.revealed) {
      let btn = document.createElement("button");
      btn.textContent = p.id + "Pを公開";
      btn.onclick = ()=>revealNumber(p.id);
      area.appendChild(btn);
    }
  });
}

function revealNumber(pid) {
  const p = players.find(x => x.id == pid);
  if (!p) return;

  // ダイアログONなら確認、OFFなら即公開
  if (!confirmOnReveal || confirm(pid + "Pの数字を公開します。よろしいですか？")) {
    p.revealed = true;
    revealed.push({ id: p.id, num: p.num });

    let card = document.createElement("div");
    card.className = "card";
    card.style.zIndex = revealed.length;
    let label = document.createElement("div");
    label.className = "playerLabel";
    label.textContent = p.id + "P";
    let num = document.createElement("div");
    num.textContent = p.num;
    card.appendChild(label);
    card.appendChild(num);

    document.getElementById("revealedLog").appendChild(card);

    renderRevealButtons();
    if (revealed.length === players.length) {
      finishGame();
    }
  }
}


function finishGame() {
  document.getElementById("game").classList.add("hidden");
  document.getElementById("result").classList.remove("hidden");

  const revealedLog2 = document.getElementById("revealedLog2");
  revealedLog2.innerHTML = "";

  // 正解の並び（昇順）でのインデックスを作る
  const sorted = [...revealed].sort((a, b) => a.num - b.num);
  const expectedIndex = new Map();
  for (let i = 0; i < sorted.length; i++) {
    expectedIndex.set(sorted[i].num, i);
  }

  let success = true;

  for (let i = 0; i < revealed.length; i++) {
    const { id, num } = revealed[i];
    const shouldBe = expectedIndex.get(num);

    const card = document.createElement("div");
    card.className = "card";
    card.style.zIndex = i + 1;

    const label = document.createElement("div");
    label.className = "playerLabel";
    label.textContent = id + "P"; // ←ここを「1枚目」から「1P」に変更

    const numDiv = document.createElement("div");
    numDiv.textContent = num;

    card.appendChild(label);
    card.appendChild(numDiv);

    // 本来のインデックスと違えば赤くする
    if (shouldBe !== i) {
      card.classList.add("wrong");
      success = false;
    }

    revealedLog2.appendChild(card);
  }

  document.getElementById("resultMessage").textContent =
    success ? "成功！" : "失敗！";
}



function restartGame() {
  document.getElementById("result").classList.add("hidden");
  startGame();
}

function backToStart() {
  document.getElementById("result").classList.add("hidden");
  document.getElementById("setup").classList.remove("hidden");
}
</script>
</body>
</html>
